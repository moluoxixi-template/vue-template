/**
 * 应用入口文件
 * 初始化 React 应用并挂载到 DOM
 * 
 * 架构说明：
 * - 容器模式（Container Pattern）：模板零逻辑，只负责展开最终配置
 * - 所有处理由中央配置处理器完成
 * - 通过 main.typeImports、main.imports、main.inits 数组注入代码
 */

<% if (main.typeImports.length > 0) { -%>
<%- main.typeImports.join('\n') %>

<% } -%>
<%- main.imports.join('\n') %>
<% if (main.styles.length > 0) { -%>

// 导入样式文件
<%- main.styles.join('\n') %>
<% } -%>


<% if (main.qiankun) { -%>
/**
 * 渲染应用（支持 qiankun 微前端）
 * @param props qiankun 传递的 props
 */
function render(props: QiankunProps = {}) {
  const { container } = props
  const rootElement = container
    ? container.querySelector('#app')
    : document.querySelector('#app')

  if (!rootElement) {
    throw new Error('Root element not found')
  }

  const root = createRoot(rootElement)

<% if (main.inits.length > 0) { -%>
<%- main.inits.map(init => `  ${init}`).join('\n') %>
<% } -%>
<% if (main.renderCode) { -%>
  <%- main.renderCode.split('\n').map(line => `  ${line}`).join('\n') %>
<% } else { -%>
  root.render(
    <StrictMode>
      <App />
    </StrictMode>,
  )
<% } -%>
}

// 独立运行时
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {
  render({})
}
else {
  renderWithQiankun({
    mount(props: QiankunProps) {
      render(props)
    },
    bootstrap() {
      // qiankun 启动钩子
    },
    unmount() {
      // qiankun 卸载钩子
    },
    update() {
      // qiankun 更新钩子
    },
  })
}
<% } else { -%>
/**
 * 独立运行模式
 */
const rootElement = document.querySelector('#app')

if (!rootElement) {
  throw new Error('Root element not found')
}

const root = createRoot(rootElement)

<% if (main.inits.length > 0) { -%>
<%- main.inits.map(init => `  ${init}`).join('\n') %>
<% } -%>
<% if (main.renderCode) { -%>
<%- main.renderCode.split('\n').map(line => `  ${line}`).join('\n') %>
<% } else { -%>
root.render(
  <StrictMode>
    <App />
  </StrictMode>,
)
<% } -%>
<% } -%>
