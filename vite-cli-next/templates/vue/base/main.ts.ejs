/**
 * 应用入口文件
 * 初始化 Vue 应用并挂载到 DOM
 */

<%_ if (qiankun) { _%>
import type { QiankunProps } from 'vite-plugin-qiankun/dist/helper';
import { qiankunWindow, renderWithQiankun } from 'vite-plugin-qiankun/dist/helper';
<%_ } _%>
import { createApp } from 'vue';
import directives from '@/directives';
<%_ if (i18n) { _%>
import i18n from '@/locales';
<%_ } _%>
import { store } from '@/stores';
<%_ if (sentry) { _%>
import { initSentry } from '@/utils/sentry';
<%_ } _%>
import App from './App.vue';
import getRouter from './router';

// 导入样式文件
<%_ if (isElementPlus) { _%>
import '@/assets/styles/element/index.scss';
<%_ } else if (isAntDesignVue) { _%>
import 'ant-design-vue/dist/reset.css';
<%_ } _%>
import '@/assets/styles/main.scss';
import '@/assets/fonts/index.css';

let app: ReturnType<typeof createApp> | null = null;

<%_ if (qiankun) { _%>
/**
 * 渲染应用（支持 qiankun 微前端）
 * @param props qiankun 传递的 props
 */
async function render(props: QiankunProps = {}): Promise<void> {
  const { container } = props;
  app = createApp(App);
  
  // 注册指令
  directives(app);

  const router = getRouter(props);

<%_ if (sentry) { _%>
  // 初始化 Sentry（生产环境标准配置）
  initSentry(app, router);

<%_ } _%>
  app.use(store);
<%_ if (i18n) { _%>
  app.use(i18n);
<%_ } _%>
  app.use(router);
  app.config.warnHandler = () => null;

  if (container) {
    const root = container.querySelector('#app');
    app.mount(root);
  } else {
    app.mount('#app');
  }
}

// 独立运行时
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {
  render({});
} else {
  renderWithQiankun({
    async mount(props: QiankunProps) {
      await render(props);
    },
    bootstrap() {
      // qiankun 启动钩子
    },
    unmount() {
      app?.unmount();
      app = null;
    },
    update() {
      // qiankun 更新钩子
    },
  });
}
<%_ } else { _%>
/**
 * 独立运行模式
 */
app = createApp(App);

// 注册指令
directives(app);

const router = getRouter({});

<%_ if (sentry) { _%>
// 初始化 Sentry（生产环境标准配置）
initSentry(app, router);

<%_ } _%>
app.use(store);
<%_ if (i18n) { _%>
app.use(i18n);
<%_ } _%>
app.use(router);
app.config.warnHandler = () => null;

app.mount('#app');
<%_ } _%>

