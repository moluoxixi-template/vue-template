/**
 * 应用入口文件
 * 初始化 Vue 应用并挂载到 DOM
 * 
 * 架构说明：
 * - 容器模式（Container Pattern）：模板零逻辑，只负责展开最终配置
 * - 所有处理由中央配置处理器完成
 * - 通过 main.typeImports、main.imports、main.inits 数组注入代码
 */

<% if (main.typeImports.length > 0) { -%>
<%- main.typeImports.join('\n') %>

<% } -%>
<%- main.imports.join('\n') %>
<% if (main.styles.length > 0) { -%>

// 导入样式文件
<%- main.styles.join('\n') %>
<% } -%>

let app: App | null = null

<% if (main.qiankun) { -%>
/**
 * 渲染应用（支持 qiankun 微前端）
 * @param props qiankun 传递的 props
 */
async function render(props: QiankunProps = {}) {
  const { container } = props
  app = createApp(App)

<%- main.inits.map(init => `  ${init}`).join('\n') %>
  app.config.warnHandler = () => null

  if (container) {
    const root = container.querySelector('#app')
    app.mount(root)
  }
  else {
    app.mount('#app')
  }
}

// 独立运行时
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {
  render({}).then()
}
else {
  renderWithQiankun({
    async mount(props: QiankunProps) {
      await render(props)
    },
    bootstrap() {
      // qiankun 启动钩子
    },
    unmount() {
      app?.unmount()
      app = null
    },
    update() {
      // qiankun 更新钩子
    },
  })
}
<% } else { -%>
/**
 * 独立运行模式
 */
app = createApp(App)

<%- main.inits.map(init => `  ${init}`).join('\n') %>
app.config.warnHandler = () => null

app.mount('#app')
<% } -%>
